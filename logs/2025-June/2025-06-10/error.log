[2025-06-10 17:40:23,542] ERROR django.request Internal Server Error: /canteen-dashboard/
Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 275, in ensure_connection
    self.connect()
    ~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\utils\asyncio.py", line 26, in inner
    return func(*args, **kwargs)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 256, in connect
    self.connection = self.get_new_connection(conn_params)
                      ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 368, in get_new_connection
    conn = Database.connect(connstr, **args)
pyodbc.OperationalError: ('08S01', '[08S01] [Microsoft][ODBC Driver 17 for SQL Server]Communication link failure (0) (SQLSetConnectAttr(SQL_ATTR_AUTOCOMMIT)); [08S01] [Microsoft][ODBC Driver 17 for SQL Server]The connection is broken and recovery is not possible. The client driver attempted to recover the connection one or more times and all attempts failed. Increase the value of ConnectRetryCount to increase the number of recovery attempts. (0)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "L:\oneSource_Live\oneSource\CANTEEN\views.py", line 183, in canteen_dashboard
    shift_counts = Counter(a.shift.name if a.shift else "Unknown" for a in attendances)
                                                                           ^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 400, in __iter__
    self._fetch_all()
    ~~~~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 1928, in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 91, in __iter__
    results = compiler.execute_sql(
        chunked_fetch=self.chunked_fetch, chunk_size=self.chunk_size
    )
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\sql\compiler.py", line 1560, in execute_sql
    cursor = self.connection.cursor()
  File "L:\oneSource_Live\venv\Lib\site-packages\django\utils\asyncio.py", line 26, in inner
    return func(*args, **kwargs)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 316, in cursor
    return self._cursor()
           ~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 261, in _cursor
    conn = super()._cursor()
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 292, in _cursor
    self.ensure_connection()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\utils\asyncio.py", line 26, in inner
    return func(*args, **kwargs)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 274, in ensure_connection
    with self.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 275, in ensure_connection
    self.connect()
    ~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\utils\asyncio.py", line 26, in inner
    return func(*args, **kwargs)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\base\base.py", line 256, in connect
    self.connection = self.get_new_connection(conn_params)
                      ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 368, in get_new_connection
    conn = Database.connect(connstr, **args)
django.db.utils.OperationalError: ('08S01', '[08S01] [Microsoft][ODBC Driver 17 for SQL Server]Communication link failure (0) (SQLSetConnectAttr(SQL_ATTR_AUTOCOMMIT)); [08S01] [Microsoft][ODBC Driver 17 for SQL Server]The connection is broken and recovery is not possible. The client driver attempted to recover the connection one or more times and all attempts failed. Increase the value of ConnectRetryCount to increase the number of recovery attempts. (0)')
[2025-06-10 17:40:23,559] ERROR django.server "GET /canteen-dashboard/ HTTP/1.1" 500 145
[2025-06-10 17:40:23,560] ERROR django.request Internal Server Error: /api/dashboard-data/
Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\fields\related_descriptors.py", line 236, in __get__
    rel_obj = self.field.get_cached_value(instance)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\fields\mixins.py", line 15, in get_cached_value
    return instance._state.fields_cache[cache_name]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
KeyError: 'department'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 677, in execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
pyodbc.OperationalError: ('08S01', '[08S01] [Microsoft][ODBC Driver 17 for SQL Server]Communication link failure (0) (SQLPrepare); [08S01] [Microsoft][ODBC Driver 17 for SQL Server]The connection is broken and recovery is not possible. The client driver attempted to recover the connection one or more times and all attempts failed. Increase the value of ConnectRetryCount to increase the number of recovery attempts. (0)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\sql\compiler.py", line 1562, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 677, in execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
django.db.utils.OperationalError: ('08S01', '[08S01] [Microsoft][ODBC Driver 17 for SQL Server]Communication link failure (0) (SQLPrepare); [08S01] [Microsoft][ODBC Driver 17 for SQL Server]The connection is broken and recovery is not possible. The client driver attempted to recover the connection one or more times and all attempts failed. Increase the value of ConnectRetryCount to increase the number of recovery attempts. (0)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "L:\oneSource_Live\venv\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\views\decorators\http.py", line 64, in inner
    return func(request, *args, **kwargs)
  File "L:\oneSource_Live\oneSource\CANTEEN\views.py", line 424, in dashboard_data_api
    'department': a.employee.department.name if a.employee.department else "",
                                                ^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\fields\related_descriptors.py", line 254, in __get__
    rel_obj = self.get_object(instance)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\fields\related_descriptors.py", line 217, in get_object
    return qs.get(self.field.get_reverse_related_filter(instance))
           ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 645, in get
    num = len(clone)
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 382, in __len__
    self._fetch_all()
    ~~~~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 1928, in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\query.py", line 91, in __iter__
    results = compiler.execute_sql(
        chunked_fetch=self.chunked_fetch, chunk_size=self.chunk_size
    )
  File "L:\oneSource_Live\venv\Lib\site-packages\django\db\models\sql\compiler.py", line 1565, in execute_sql
    cursor.close()
    ~~~~~~~~~~~~^^
  File "L:\oneSource_Live\venv\Lib\site-packages\mssql\base.py", line 606, in close
    self.cursor.close()
    ~~~~~~~~~~~~~~~~~^^
pyodbc.ProgrammingError: The cursor's connection has been closed.
[2025-06-10 17:40:23,575] ERROR django.server "GET /api/dashboard-data/ HTTP/1.1" 500 145
